<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Inicio</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/css/select2.min.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Roboto|Passion+One" rel="stylesheet">
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.css" rel="stylesheet" />

    <link href="_css/dataTables.bootstrap.css" rel="stylesheet" type="text/css" />
    <link href="_css/Btn.css" rel="stylesheet" type="text/css" />
    <link href="_css/animate.css" rel="stylesheet" type="text/css" />
    <link href="_css/style.css" rel="stylesheet" type="text/css" />

    <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js'></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/js/select2.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.0/Chart.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.js"></script>
    <script src="http://www.chartjs.org/samples/latest/utils.js"></script>

    <script>
        var ajax = null;
    </script>


<body>


<div class="mold-tela">


    <div class="header tab">
        <div class="cel w3">

        </div>
        <div class="search cel">
            <a class="logo" href="javascript:void(0);"><img src="_img/site_logo.png" alt=""></a>
        </div>
        <div class="user-header cel txt-right w3">
            <span class="nome-perfil"></span>
            <img class='img-perfil'/>
        </div>
    </div>




    <div class="body-content">
        <div id="menu-container">
            <div id="menu-wrapper">
                <div id="hamburger-menu"><span></span><span></span><span></span></div>
                <div class="mouse-hover"></div>
            </div>
            <!-- menu-wrapper -->
            <ul class="menu-list accordion">

                <div class="coluna-menu"></div>

                <li id="nav1" class="item-menu">
                    <a class="menu-link" href="../projeto_compras/gestor">
                        <div class="icon-menu solicitacao"></div>
                        <div class="txt-menu"><span>Ordem de Compra</span></div>
                        <div class="count-not">+99</div>
                    </a>
                </li>
                <!-- accordion-toggle -->

                <!-- menu-submenu accordon-content-->
                <li id="nav2" class="item-menu">
                    <a class="menu-link" href="telafuncionario.html">
                        <div class="icon-menu funcionarios"></div>
                        <div class="txt-menu"><span>Funcionarios</span></div>
                    </a>
                </li>
                <!-- accordion-toggle -->

                <!-- menu-submenu accordon-content-->
                <li id="nav3" class="item-menu">
                    <a class="menu-link" href="telafornecedores.html">
                        <div class="icon-menu fornecedores"></div>
                        <div class="txt-menu"><span>Fornecedores</span></div>
                    </a>
                </li>
                <!-- accordion-toggle -->

                <li id="nav4" class="item-menu">
                    <a class="menu-link" href="telacotacao.html">
                        <div class="icon-menu cotacao"></div>
                        <div class="txt-menu"><span>Cotação</span></div>
                        <div class="count-not">1</div>
                    </a>
                </li>

                <li id="nav5" class="item-menu">
                    <a class="menu-link" href="telaordemcompra.html">
                        <div class="icon-menu ordem"></div>
                        <div class="txt-menu"><span>Ordem de Compra</span></div>
                    </a>
                </li>

                <li id="nav6" class="item-menu">
                    <a class="menu-link" href="telahistoricocompra.html">
                        <div class="icon-menu historico"></div>
                        <div class="txt-menu"><span>Historico de Compra</span></div>
                    </a>
                </li>




                <!-- menu-submenu accordon-content-->
            </ul>
            <!-- menu-list accordion-->
        </div>
        <!-- menu-container -->


        <div class="content-tela tela-cotacao">



            <div class="content-left h12">
                <div class="title-header-box">
                    Ordem de Compra
                    <div class="sub-title floatright">
                        CLIQUE EM UMA ORDEM PARA ANALISAR
                    </div>
                </div>

                <table class="tabela">
                    <thead>
                    <tr>
                        <th> ID </th>
                        <th> Produto </th>
                        <th> Fornecedor </th>
                        <th> Setor </th>
                        <th> Status </th>
                        <th></th>
                    </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>


            </div>
            <div class="content-right h12">
                <div class="title-header-box">
                    Informações
                    <div class="sub-title floatright none">
                        FORMULÁRIO DE ORDEM DE COMPRA
                    </div>
                </div>

                <div class="cont empty-solicitacao">
                    <div class="cont-canvas">
                        <div class="box-canvas ">
                            <div class="flex-box legend-chart">
                                <div class="item-flex-box no-padding">
                                    Pendente
                                    <span class="spn-chart-pendente">0</span>
                                </div>
                                <div class="item-flex-box no-padding">
                                    Comprado
                                    <span class="spn-chart-comprado">0</span>
                                </div>
                            </div>
                            <div class="div-canvas canvas-compras-tras relative w12" style="left: 0; top:0; height: calc(100% - 150px);">
                                <canvas id="grafico-compras-tras" style="width: 100%; height: 100%; border-radius: 5px;"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="cont form-cotacao none">
                    <div class="flex-box">
                        <div class="info-item item-flex-box w12">
                            <label>Fornecedor</label>
                            <select class="slt-fornecedores fornecedor" data-placeholder="Selecione os fornecedores" style="width: 100%" multiple></select>
                        </div>
                        <div class="info-item item-flex-box w3 hidden">
                            <label>Status</label>
                            <div class="cmp-txt">
                                <input type="text" class="status_compra" disabled/>
                            </div>
                        </div>
                        <div class="info-item item-flex-box w10">
                            <label>Produto</label>
                            <div class="cmp-txt">
                                <input type="text" class="produto" placeholder="Clique em uma cotação para ver o produto" disabled/>
                            </div>
                        </div>
                        <div class="info-item item-flex-box w2">
                            <label>Quantidade</label>
                            <div class="cmp-txt">
                                <input type="number" class="quantidade" min="1" placeholder="0" disabled/>
                            </div>
                        </div>

                        <div class="title-cont">
                            Resposta do fornecedor
                        </div>
                        <div class="info-item item-flex-box w4">
                            <label>Preço Unitário</label>
                            <div class="cmp-txt">
                                <input type="text" class="preco" placeholder="0,00" disabled/>
                            </div>
                        </div>
                        <div class="info-item item-flex-box w4">
                            <label>Total</label>
                            <div class="cmp-txt">
                                <input type="text" class="total" placeholder="0,00" disabled/>
                            </div>
                        </div>
                        <div class="info-item item-flex-box w4">
                            <label>Data de entrega</label>
                            <div class="cmp-txt">
                                <input type="text" class="data" placeholder="00/00/0000" disabled/>
                            </div>
                        </div>
                        <div class="cont-btn txt-right">

                            <button type="button" class="Btn Btn--default-outline Btn--icon-before Btn--ver-resumo floatleft" onclick="resumo()">
                                <div class="tab">
                                    <div class="cel">
                                        <i class="fa fa-area-chart" aria-hidden="true"></i>
                                    </div>
                                    <div class="cel">
                                        Ver resumo
                                    </div>
                                </div>
                            </button>

                            <button type="button" class="Btn Btn--finalizar Btn--icon-before Btn--margin-left" onclick="finalizar(true)">
                                <div class="tab">
                                    <div class="cel">
                                        <i class="fa fa-flag" aria-hidden="true"></i>
                                    </div>
                                    <div class="cel">
                                        Finalizar
                                    </div>
                                </div>
                            </button>

                        </div>
                    </div>
                </div>

                <div class="cont tab concluido-sucesso color-success none">
                    <div class="cel">
                        <img class="cotacao_img animated fadeInUp" src="_img/icones/concluido.svg" alt="">
                        <div class="tit-resposta">Compra concluída</div>
                        <div class="txt-resposta">
                            Este item foi comprado
                        </div>
                    </div>
                </div>

                <div class="cont tab rejeitar-sucesso color-danger none">
                    <div class="cel">
                        <img class="cotacao_img animated fadeInUp" src="_img/icones/delete.svg" alt="">
                        <div class="tit-resposta">Pedido deletado</div>
                        <div class="txt-resposta">
                            Este pedido foi deletado<br>e removido da lista.
                        </div>
                    </div>
                </div>

                <div class="cont tab add-sucesso color-success none">
                    <div class="cel">
                        <img class="cotacao_img animated fadeInDown" src="_img/icones/em-cotacao.svg" alt="">
                        <div class="tit-resposta">Cotação solicitada</div>
                        <div class="txt-resposta">
                            Um email com as informações deste pedido<br>foi enviada para o(s) fornecedor(es) selecionado(s)
                        </div>
                    </div>
                </div>

            </div>


        </div>

        <div class="telacadastro"></div>

        <script type="text/javascript">

            var pedidoAtual = {};
            var tabela = {};
            var linhaAtual = {};
            var fadeInResumo = true;

            $('.slt-fornecedores').select2({
                ajax: {
                    //url: 'https://api.mockaroo.com/api/684a4fd0?count=25&key=164c6660',
                    url: 'https://richardds.com.br/projetos/teste/fornecedores.php',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    type: "GET", /* or type:"GET" or type:"PUT" */
                    dataType: "json",
                    processResults: function (data) {
                        return {
                            results: data
                        };
                    }
                }
            });

            function notifica(msg,tipo){
                $.notify({
                    // options
                    message: msg
                },{
                    // settings
                    type: tipo,
                    timer: 1000,
                    offset: {y:75, x:15},
                    animate: {
                        enter: 'animated fadeInDown',
                        exit: 'animated fadeOutUp'
                    },
                    placement: {
                        from: "top",
                        align: "right"
                    },
                });
            }

            function retorno_acao(){
                fadeInResumo = true;
                $('.cont, .content-right .sub-title').hide();
                $('.concluido-sucesso').fadeIn().css({'display': 'table'});
                setTimeout(function () {
                    if(fadeInResumo) resumo();
                }, 10000);

            }

            function finalizar(){

                var HTML_NF =
                    '<form method="post" class="form-update" action="http://richardds.com.br/projetos/galeria/insereImagem.php?pasta=imagens&class=contItemLAL" enctype="multipart/form-data" novalidate>' +
                    '   <input type="file" name="arquivo[]" id="file" class="box__file"/>' +
                    '   <label class="area-upload tab" for="file"><div class="cel"><div class="txt-update">Clique aqui ou arraste<br>um arquivo para esta area!</div><span class="progresso-upload"></span></div></label>' +
                    '</fom>';
                swal({
                        title: 'Insira a nota fiscal',
                        text: HTML_NF,
                        html: true,
                        allowOutsideClick: true,
                        confirmButtonText: 'Fechar'
                    },
                    function(data){
                        if(!data) ajax.abort();
                    }
                );
                init_area_upload();
            }

            function ir_para_info(data){

                if(data) {

                    pedidoAtual = data;

                    $('.info-item input').val('');

                    $.each(data, function (k, v) {
                        $('.info-item .' + k).val(v);
                    });

                    var newState = new Option(data.fornecedor, data.fornecedor, true, true);
                    $(".fornecedor").prop('disabled', true).html(newState).trigger('change');

                    $('.info-item .total').val((data.quantidade * data.preco).toFixed(2));

                    $('.cont-btn .Btn').hide();

                    $('.Btn--ver-resumo, .Btn--cancelar, .Btn--comprar, .Btn--finalizar').show();

                    switch(data.status_cotacao){
                        case 'Pendente':
                            $('.Btn--ver-resumo, .Btn--cancelar, .Btn--comprar').show();
                            break;
                        case 'Comprado':
                            $('.Btn--ver-resumo, .Btn--finalizar').show();
                            break;
                    }


                }

                $('.cont').hide();
                $('.form-cotacao, .content-right .sub-title').fadeIn();

            }

            function resumo(){
                $('.cont, .content-right .sub-title').hide();
                $('.empty-solicitacao').fadeIn();
            }

            function enviar_mensagem(){
                if($('.mensagem-cancel textarea').val()!=''){
                    $('.cont, .content-right .sub-title').hide();
                    $('.rejeitar-sucesso').fadeIn().css({'display':'table'});
                    setTimeout(function(){
                        resumo()
                    },5000);
                }else{
                    notifica("Insira a justificativa para enviar a mensagem",'danger');
                }

            }

            function randomScalingFactor() {
                return Math.round(Samples.utils.rand(0, 25));
            }

            var chartColors = {
                pendente: '#ff5722',
                comprado: '#5ac2a0',
            };

            var borderWith = .001;

            var data_chart = [
                [
                    randomScalingFactor()
                ],
                [
                    randomScalingFactor()
                ]
            ];

            $('.spn-chart-pendente')
                .css({ 'color': chartColors.pendente})
                .text(data_chart[0]);
            $('.spn-chart-comprado')
                .css({ 'color': chartColors.comprado})
                .text(data_chart[1]);

            var ctx_trs = document.getElementById("grafico-compras-tras").getContext("2d");

            var config_tras = {
                type: 'bar',
                data: {
                    datasets: [{

                        label: 'Pendente',
                        backgroundColor: chartColors.pendente,
                        borderColor: chartColors.pendente,
                        data: data_chart[0],
                        fill: true,
                        borderWidth: borderWith,
                        pointRadius: 0
                    }, {
                        label: 'Comprado',
                        backgroundColor: chartColors.comprado,
                        borderColor: chartColors.comprado,
                        data: data_chart[1],
                        fill: true,
                        borderWidth: borderWith,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    title:{
                        display:false
                    },
                    hover: {
                        mode: 'nearest',
                        intersect: true
                    },
                    scales: {
                        xAxes: [{
                            display: false,
                            ticks: {
                                mirror: true,
                                fontSize: 16,
                                padding: -50,
                                callback: function(value, index, values) {
                                    return '';
                                }
                            }
                        }],
                        yAxes: [{
                            display: true,
                            gridLines: {
                                display: true,
                                drawBorder: true
                            },
                            ticks: {
                                mirror: true,
                                fontSize: 18,
                                padding: -15,
                                fontFamily: "Passion One",
                                fontColor:"#acacac",
                                beginAtZero: true
                            }

                        }]
                    },
                    legend: {
                        display: false
                    }
                }
            };


            $(function(){


                $('[data-toggle="tooltip"]').tooltip({trigger: "hover"});

                tabela = $('.tabela').DataTable( {
                    ajax: {
                        //url: "https://api.mockaroo.com/api/a61e2ee0?count=10&key=164c6660",
                        //dataSrc: ''
                        url:'https://richardds.com.br/projetos/teste/solicitacao_de_compra.php',
                        dataSrc: 'data'
                    },
                    columns: [
                        { data: 'id' },
                        { data: 'produto' },
                        { data: 'fornecedor' },
                        { data: 'setor' },
                        { data: 'status_compra' }
                    ],
                    "info": false,
                    "lengthChange": false,
                    "paging": false,
                    "bProcessing": false,
                    "language": {
                        "loadingRecords": "Procurando...",
                        "infoEmpty": "Nenhum item encontrado",
                        "search": "",
                        "searchPlaceholder": "Buscar ordem de compra",
                        "paginate": {
                            "first":      "Primeiro",
                            "last":       "Último",
                            "next":       "Próximo",
                            "previous":   "Anterior"
                        },
                    },
                    'createdRow': function( row, data, dataIndex ) {
                        $(row).on('click',function(){
                            linhaAtual = row;
                            fadeInResumo = false;
                            ir_para_info(data);
                        })
                        if( data.novo ) {
                            $(row).addClass( 'item-novo' );
                            setTimeout(function(){
                                $(row).removeClass( 'item-novo' );
                            },2000);

                        }
                    },
                    "aoColumnDefs": [
                        { "bSearchable": false, "bVisible": false,  "aTargets": [ 0 ] },
                        { "aTargets": [ 1 ] },
                        { "aTargets": [ 2 ] },
                        { "bSearchable": false, "bVisible": false,  "aTargets": [ 3 ] },
                        {
                            "bSearchable": false,
                            "bVisible": false,
                            "mRender": function ( data, type, row ) {
                                var color = '';
                                switch (data){
                                    case 'Pendente': color = chartColors.pendente; break;
                                    default: color = chartColors.comprado;
                                }
                                return '<span style="color:' + color + '">' + data + '</span>';
                            },
                            "aTargets": [ 4 ]
                        },
                        {
                            "mRender": function ( data, type, row ) {
                                return '<span class="Icon--Info" data-toggle="tooltip" title="Mais informações"><i class="fa fa-info-circle" aria-hidden="true"></i></span>';
                            },
                            "aTargets": [ 5 ]
                        }

                    ]
                });


                new Chart(ctx_trs, config_tras);


            });

        </script>

        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        <!-- DATA TABES SCRIPT -->
        <script src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js" type="text/javascript"></script>
        <script src="http://cdn.datatables.net/buttons/1.4.2/js/buttons.html5.min.js" type="text/javascript"></script>

        <script src="js/dataTables.bootstrap.min.js" type="text/javascript"></script>
        <script src="js/menu.js"></script>
        <script src="https://cdn.jsdelivr.net/mojs/latest/mo.min.js"></script>
        <script src="js/animateSVG.js"></script>
        <script src="js/bootstrap-notify.min.js"></script>
        <script src="js/jquery.form.min.js"></script>
        <script src="js/upLoadFile.js"></script>

    </div>
</div>
</body>
</html>