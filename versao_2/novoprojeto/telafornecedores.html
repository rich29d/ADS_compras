<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Inicio</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/css/select2.min.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Roboto|Passion+One" rel="stylesheet">
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.css" rel="stylesheet" />
    <link href="http://www.pomojob.richardds.com.br/comum/admin/plugins/datatables/dataTables.bootstrap.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="api/datepicker/css/bootstrap-datepicker.min.css">

    <link href="_css/Btn.css" rel="stylesheet" type="text/css" />
    <link href="_css/animate.css" rel="stylesheet" type="text/css" />
    <link href="_css/style.css" rel="stylesheet" type="text/css" />

    <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js'></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/js/select2.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.0/Chart.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.js"></script>
    <script src="http://www.chartjs.org/samples/latest/utils.js"></script>
    <script src="js/jquery.mask.min.js"></script>
    <script src="api/datepicker/js/bootstrap-datepicker.min.js"></script>
    <script src="api/datepicker/locales/bootstrap-datepicker.pt-BR.min.js"></script>
</head>


<body>


<div class="mold-tela">


    <div class="header tab">
        <div class="cel w3">

        </div>
        <div class="search cel">
            <a class="logo" href="javascript:void(0);"><img src="_img/site_logo.png" alt=""></a>
        </div>
        <div class="user-header cel txt-right w3">
            <span class="nome-perfil"></span>
            <img class='img-perfil'/>
        </div>
    </div>




    <div class="body-content">
        <div id="menu-container">
            <div id="menu-wrapper">
                <div id="hamburger-menu"><span></span><span></span><span></span></div>
                <div class="mouse-hover"></div>
            </div>
            <!-- menu-wrapper -->
            <ul class="menu-list accordion">

                <div class="coluna-menu"></div>

                <li id="nav1" class="item-menu">
                    <a class="menu-link" href="../projeto_compras/gestor">
                        <div class="icon-menu solicitacao"></div>
                        <div class="txt-menu"><span>Solicitação de Compra</span></div>
                        <div class="count-not">+99</div>
                    </a>
                </li>
                <!-- accordion-toggle -->

                <!-- menu-submenu accordon-content-->
                <li id="nav2" class="item-menu">
                    <a class="menu-link" href="telafuncionario.html">
                        <div class="icon-menu funcionarios"></div>
                        <div class="txt-menu"><span>Funcionarios</span></div>
                    </a>
                </li>
                <!-- accordion-toggle -->

                <!-- menu-submenu accordon-content-->
                <li id="nav3" class="item-menu">
                    <a class="menu-link" href="telafornecedores.html">
                        <div class="icon-menu fornecedores"></div>
                        <div class="txt-menu"><span>Fornecedores</span></div>
                    </a>
                </li>
                <!-- accordion-toggle -->

                <li id="nav4" class="item-menu">
                    <a class="menu-link" href="telacotacao.html">
                        <div class="icon-menu cotacao"></div>
                        <div class="txt-menu"><span>Cotação</span></div>
                        <div class="count-not">1</div>
                    </a>
                </li>

                <li id="nav5" class="item-menu">
                    <a class="menu-link" href="telaordemcompra.html">
                        <div class="icon-menu ordem"></div>
                        <div class="txt-menu"><span>Ordem de Compra</span></div>
                    </a>
                </li>

                <li id="nav6" class="item-menu">
                    <a class="menu-link" href="telahistoricocompra.html">
                        <div class="icon-menu historico"></div>
                        <div class="txt-menu"><span>Historico de Compra</span></div>
                    </a>
                </li>




                <!-- menu-submenu accordon-content-->
            </ul>
            <!-- menu-list accordion-->
        </div>
        <!-- menu-container -->


        <!-- Comparar -->

        <div class="cont-comparar none">

            <div class="bg-modal" onclick="$('.cont-comparar').fadeOut();"></div>
            <div class="comparar">
                <table class="tabela-comparar w12 h12">

                </table>
            </div>

        </div>


        <div class="content-tela tela-cotacao">



            <div class="content-left h12">
                <div class="title-header-box">
                    Fornecedores
                    <div class="sub-title floatright">
                        CLIQUE EM UMA REGISTRO PARA ANALISAR
                    </div>
                </div>

                <table class="tabela tabela_funcionarios w12 ">
                    <thead>
                    <tr>
                        <th> Fornecedor </th>
                        <th> Categoria </th>
                        <th></th>
                    </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>


            </div>
            <div class="content-right h12">
                <div class="title-header-box">
                    Informações
                    <div class="sub-title floatright">
                        FORMULÁRIO DE FONECEDOR
                    </div>
                </div>

                <div class="cont form-fornecedor">
                    <div class="flex-box">

                        <div class="info-item item-flex-box w12">
                                <label>Nome Fantásia</label>
                                <div class="cmp-txt">
                                    <input type="text" class="nome_fantasia"/>
                                </div>
                            </div>
                            
                            <div class="info-item item-flex-box w12">
                                <label>Razão Social</label>
                                <div class="cmp-txt">
                                    <input type="text" class="razao_social"/>
                                </div>
                            </div>

                            <div class="info-item item-flex-box w5">
                                <label>CNPJ</label>
                                <div class="cmp-txt">
                                    <input type="text" class="cnpj mask-cnpj" />
                                </div>
                            </div>

                            <div class="info-item item-flex-box w7">
                                <label>Categoria</label>
                                <div class="cmp-txt">
                                    <select class="categoria_id w12 select2_search"></select>
                                </div>
                            </div>
                            
                            <div class="info-item item-flex-box w4">
                                <label>Telefone</label>
                                <div class="cmp-txt">
                                    <input type="text" class="telefone mask-telefone" />
                                </div>
                            </div>

                            <div class="info-item item-flex-box w8">
                                <label>Email</label>
                                <div class="cmp-txt">
                                    <input type="text" class="email" />
                                </div>
                            </div>

                            <div class="info-item item-flex-box w3">
                                <label>CEP</label>
                                <div class="cmp-txt">
                                    <input type="text" class="cep w12 mask-cep" />
                                </div>
                            </div>

                            <div class="info-item item-flex-box w9">
                                <label>Endereço</label>
                                <div class="cmp-txt">
                                    <input type="text" class="endereco logradouro" />
                                </div>
                            </div>

                            <div class="info-item item-flex-box w2">
                                <label>Número</label>
                                <div class="cmp-txt">
                                    <input type="text" class="numero_endereco" />
                                </div>
                            </div>
                            
                            <div class="info-item item-flex-box w10">
                                <label>Bairro</label>
                                <div class="cmp-txt">
                                    <input type="text" class="bairro" />
                                </div>
                            </div>
                            
                            <div class="info-item item-flex-box w10">
                                <label>Cidade</label>
                                <div class="cmp-txt">
                                    <input type="text" class="cidade localidade" />
                                </div>
                            </div>
                            
                            <div class="info-item item-flex-box w2">
                                <label>UF</label>
                                <div class="cmp-txt">
                                    <select class="uf w12 select2_search"></select>
                                </div>
                            </div>


                        <div class="cont-btn txt-right">

                            <button type="button" class="Btn Btn--default-outline Btn--icon-before Btn--novo floatleft" onclick="ir_para_info()">
                                <div class="tab">
                                    <div class="cel">
                                        <i class="fa fa-user" aria-hidden="true"></i>
                                    </div>
                                    <div class="cel">
                                        Novo
                                    </div>
                                </div>
                            </button>

                            <button type="button" class="Btn Btn--danger Btn--icon-before Btn--deletar Btn--margin-right none" onclick="deletar_item()">
                                <div class="tab">
                                    <div class="cel">
                                        <i class="fa fa-user-times" aria-hidden="true"></i>
                                    </div>
                                    <div class="cel">
                                        Deletar
                                    </div>
                                </div>
                            </button>

                            <button type="button" class="Btn Btn--incluir Btn--success Btn--icon-before" onclick="adicionar_item()">
                                <div class="tab">
                                    <div class="cel">
                                        <i class="fa fa-user-plus" aria-hidden="true"></i>
                                    </div>
                                    <div class="cel">
                                        Incluir
                                    </div>
                                </div>
                            </button>

                            <button type="button" class="Btn Btn--editar Btn--success Btn--icon-before none" onclick="editar_item()">
                                <div class="tab">
                                    <div class="cel">
                                        <i class="fa fa-floppy-o" aria-hidden="true"></i>
                                    </div>
                                    <div class="cel">
                                        Editar
                                    </div>
                                </div>
                            </button>

                        </div>
                    </div>
                </div>

                <div class="cont tab aprovar-sucesso color-success none">
                    <div class="cel">
                        <img class="cotacao_img animated fadeInUp" src="_img/icones/ordem-compra.svg" alt="">
                        <div class="tit-resposta">Ordem de compra</div>
                        <div class="txt-resposta">
                            Este pedido foi aprovado e encaminhado<br>para a página de ordem de compra.
                        </div>
                    </div>
                </div>

                <div class="cont tab rejeitar-sucesso color-danger none">
                    <div class="cel">
                        <img class="cotacao_img animated fadeInUp" src="_img/icones/delete.svg" alt="">
                        <div class="tit-resposta">Fornecedor deletado</div>
                        <div class="txt-resposta">
                            O registro deste Fornecedor foi deletado,<br>este usuário não podera mais acessar<br>nenhuma página restrita.
                        </div>
                    </div>
                </div>

            </div>


        </div>

        <div class="telacadastro"></div>

        <script type="text/javascript">

            var itemAtual = {};
            var tabela = {};
            var linhaAtual = {};
            var fadeInResumo = true;

            function addItem() {

                var fornecedores = $('.slt-fornecedores').val();

                if(fornecedores.length == 0){
                    notifica('Preencha o campo fornecedor','danger');
                    return;
                }

                $.ajax({
                    url:'https://www.richardds.com.br/projetos/teste/success.php',
                    method: 'POST',
                    data:{},
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    async: false,
                    type: "POST", /* or type:"GET" or type:"PUT" */
                    dataType: "json",
                    success:function(resp){
                        if(resp.success){
                            fornecedores.forEach(function(v,k){
                                tabela.row.add({
                                    data: itemAtual.data,
                                    fornecedor: v,
                                    funcionario: itemAtual.funcionario,
                                    id: 0,
                                    preco: itemAtual.preco,
                                    produto: itemAtual.produto,
                                    quantidade: itemAtual.quantidade,
                                    setor: itemAtual.setor,
                                    status: itemAtual.status,
                                    status_cotacao: 'Em cotação',
                                    novo: true
                                }).draw();

                            });
                            tabela.row( linhaAtual ).remove().draw();
                            retorno_acao(3);
                        }
                    },
                    error: function(){
                        notifica('Erro ao executar está ação','danger');
                    }
                });



            }

            function alerta(title, text){
                swal({
                        title: title,
                        text: text,
                        html: true
                    }
                );
            }

            function notifica(msg,tipo){
                $.notify({
                    // options
                    message: msg
                },{
                    // settings
                    type: tipo,
                    timer: 1000,
                    offset: {y:75, x:15},
                    animate: {
                        enter: 'animated fadeInDown',
                        exit: 'animated fadeOutUp'
                    },
                    placement: {
                        from: "top",
                        align: "right"
                    },
                });
            }

            function retorno_acao(n){
                fadeInResumo = true;
                switch (n){

                    case 1:
                        swal({
                                title: 'Atenção',
                                text: 'Quer mesmo excluir este item?',
                                type: 'warning',
                                showCancelButton: true,
                                confirmButtonColor: '#e14848',
                                confirmButtonText: 'Sim',
                                cancelButtonText: 'Não',
                                closeOnConfirm: true
                            },
                            function(willDelete){
                                if (willDelete) {
                                    $('.cont, .content-right .sub-title').hide();
                                    $('.rejeitar-sucesso').fadeIn().css({'display': 'table'});
                                    tabela.row( linhaAtual ).remove().draw();
                                    setTimeout(function () {
                                        if(fadeInResumo) ir_para_info();
                                    }, 10000);
                                }
                            }
                        );

                        break;

                    case 2:
                        $('.cont, .content-right .sub-title').hide();
                        $('.aprovar-sucesso').fadeIn().css({'display': 'table'});
                        setTimeout(function () {
                            if(fadeInResumo) ir_para_info();
                        }, 10000);
                        break;

                    case 3:
                        $('.cont, .content-right .sub-title').hide();
                        $('.add-sucesso').fadeIn().css({'display': 'table'});
                        setTimeout(function () {
                            if(fadeInResumo) ir_para_info();
                        }, 10000);
                        break;

                }
            }

            function adicionar_item(){
                $.ajax({
                    url:'https://www.richardds.com.br/projetos/teste/success.php',
                    method: 'POST',
                    data:{},
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    type: "POST", /* or type:"GET" or type:"PUT" */
                    dataType: "json",
                    success:function(resp){
                        if(resp.success){
                            tabela.row.add({
                                nome: $('.nome').val(),
                                foto: itemAtual.foto,
                                cpf: $('.cpf').val(),
                                rg: $('.rg').val(),
                                email: $('.email').val(),
                                nascimento: $('.nascimento').val(),
                                num_dependentes: $('.num_dependentes').val(),
                                data_emissao: $('.data_emissao').val(),
                                setor_id: $('.setor_id').val(),
                                gestor: $('.gestor').val(),
                                novo: true
                            }).draw();
                            notifica('Fornecedor adicionado','success');
                            ir_para_info();
                        }
                    },
                    error: function(){
                        notifica('Erro ao executar está ação','danger');
                    }
                });
            }

            function deletar_item(){
                $.ajax({
                    url:'https://www.richardds.com.br/projetos/teste/success.php',
                    method: 'POST',
                    data:{},
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    type: "POST", /* or type:"GET" or type:"PUT" */
                    dataType: "json",
                    success:function(resp){
                        if(resp.success) retorno_acao(1);
                    },
                    error: function(){
                        notifica('Erro ao executar está ação','danger');
                    }
                });
            }

            function editar_item(){}

            function ir_para_info(data){

                $('.info-item input[type=text]').val('');
                $('.info-item input[type=number]').val('0');

                $('.cont-btn .Btn').hide();
                $('.Btn--novo, .Btn--incluir').show();

               if(data) {

                    itemAtual = data;

                    $.each(data, function (k, v) {
                        $('.info-item .' + k).val(v).trigger('change');
                        if(k=='razao_social') $('.info-item .' + k).val(data.nome_fantasia + ' ' + data.categoria_id + ' ' + data.razao_social);
                    });



                    $('.cont-btn .Btn').hide();
                    $('.Btn--novo, .Btn--deletar, .Btn--editar').show();


                }

                $('.cont').hide();
                $('.form-fornecedor, .content-right .sub-title').fadeIn();

            }

            function validar_imagem(type){
                const arrFormato = ['jpg','jpeg','png','gif','svg','svg+xml'];
                var formato = type.split('/')[1];
                var isIMG = $.inArray(formato,arrFormato) > -1;
                if(!isIMG) alerta('Ops','Este arquivo não é uma imagem válida');
                return isIMG;
            }


            $(function(){

                window.URL = window.URL || window.webkitURL;

                $('[data-toggle="tooltip"]').tooltip({trigger: "hover"});
                $('.mask-cnpj').mask("00.000.000/0000-00", {placeholder: "__.___.___/____-__"});
                $('.mask-cep').mask("00000-000", {placeholder: "_____-___"});
                var options =  {
                  placeholder: "(__) _____-____",
                  onKeyPress: function(tel, e, field, options) {
                    var mask = (tel.length<15) ? '(00) 0000-00000' : '(00) 00000-0000';
                    $('.mask-telefone').mask(mask, options);
                }};
                $('.mask-telefone').mask('(00) 00000-0000', options);

                $('.inp-data').datepicker({
                    language: "pt-BR"
                });
                
                $('.select2').select2({minimumResultsForSearch: -1});
                $('.select2_search').select2();

                $.ajax({
                    url:'https://api.mockaroo.com/api/2a208c30?count=27&key=164c6660',
                    method: 'get',
                    dataType: 'json',
                    success:function(data){
                        $.each(data, function(k,v){
                            $('.uf').append(new Option(v.uf,v.uf)).trigger('change');
                        });
                        $('.uf').trigger('change');
                    }
                });

                $.ajax({
                   url:'https://richardds.com.br/projetos/teste/setor.php',
                   method: 'get',
                    dataType: 'json',
                   success:function(data){
                       $.each(data, function(k,v){
                          $('.setor_id').append(new Option(v.nome,v.id));
                       });
                       $('.setor_id').select2({minimumResultsForSearch: -1});
                   }
                });

                $('#foto').on('change', function(e){
                    if(validar_imagem(e.target.files[0].type)){
                        itemAtual.foto = window.URL.createObjectURL(e.target.files[0]);
                        $('.img_foto').css({
                            'background-image':'url(' + itemAtual.foto + ')',
                        });
                    }

                });

                $('.cep').on('keyup',function(){
                    if($(this).val().length == 9){
                        $.getJSON('https://viacep.com.br/ws/' +  $(this).val().replace(/[\.-]/img,'') + '/json/',function(data){
                            $.each(data, function (k, v) {
                                $('.info-item .' + k).val(v).trigger('change');
                            });
                        });
                    }
                });

                $.getJSON('https://api.mockaroo.com/api/841b4d50?count=662&key=164c6660',function(data){
                    $.each(data, function(k,v){
                        $('.categoria_id').append(new Option(v.descricao,v.descricao));
                    });
                    $('.categoria_id').trigger('change');
                })

                tabela = $('.tabela').DataTable( {
                    ajax: {
                        url:'https://richardds.com.br/projetos/teste/fornecedores.php',
                        dataSrc: ''
                    },
                    columns: [
                        { data: 'nome_fantasia' },
                        { data: 'categoria_id' }
                    ],
                    "order": [[ 0, "asc" ]],
                    "info": false,
                    "lengthChange": false,
                    "paging": false,
                    "bProcessing": false,
                    "language": {
                        "loadingRecords": "Procurando...",
                        "infoEmpty": "Nenhum item encontrado",
                        "search": "",
                        "searchPlaceholder": "Buscar Fornecedor",
                        "paginate": {
                            "first":      "Primeiro",
                            "last":       "Último",
                            "next":       "Próximo",
                            "previous":   "Anterior"
                        },
                    },
                    'createdRow': function( row, data, dataIndex ) {
                        $(row).on('click',function(){
                            linhaAtual = row;
                            fadeInResumo = false;
                            ir_para_info(data);
                        })
                        if( data.novo ) {
                            $(row).addClass( 'item-novo' );
                            setTimeout(function(){
                                $(row).removeClass( 'item-novo' );
                            },2000);

                        }
                    },
                    "aoColumnDefs": [
                        {
                            "aTargets": [ 0 ]
                        },
                        {
                            "aTargets": [ 1 ]
                        },
                        {
                            "mRender": function ( data, type, row ) {

                                return '<span class="Icon--Info" data-toggle="tooltip" title="Mais informações"><i class="fa fa-info-circle" aria-hidden="true"></i></span>';
                            },
                            "aTargets": [ 2 ]
                        }

                    ]
                });


            });

        </script>

        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        <!-- DATA TABES SCRIPT -->
        <script src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js" type="text/javascript"></script>
        <script src="http://cdn.datatables.net/buttons/1.4.2/js/buttons.html5.min.js" type="text/javascript"></script>
        <script src="http://www.pomojob.richardds.com.br/comum/admin/plugins/datatables/dataTables.bootstrap.min.js" type="text/javascript"></script>

        <script src="js/menu.js"></script>
        <script src="https://cdn.jsdelivr.net/mojs/latest/mo.min.js"></script>
        <script src="js/animateSVG.js"></script>
        <script src="js/bootstrap-notify.min.js"></script>

    </div>
</div>
</body>
</html>